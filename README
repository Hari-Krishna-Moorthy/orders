# Orders Pub/Sub Application

## Overview

The **Orders Pub/Sub Application** is an **in-memory publish/subscribe system** built with **Golang**. It manages multiple publishers and subscribers through **WebSockets** and **REST APIs**, supporting real-time communication, safe concurrency, and topic-based message routing.

The system is designed for scalability and modularity ‚Äî allowing seamless topic management, message delivery, and authentication ‚Äî all without requiring external brokers.
Persistence (for user authentication) is handled via **PostgreSQL**.

---

## ‚öôÔ∏è Tech Stack

| Category             | Technology                                             |
| -------------------- | ------------------------------------------------------ |
| **Language**         | Go 1.24                                                |
| **Web Framework**    | [Fiber v2](https://github.com/gofiber/fiber)           |
| **Database ORM**     | [GORM v2](https://gorm.io)                             |
| **Configuration**    | [Viper](https://github.com/spf13/viper) (YAML-based)   |
| **Authentication**   | [golang-jwt/jwt/v5](https://github.com/golang-jwt/jwt) |
| **Containerization** | Docker & Docker Compose                                |

---

## Core Features

* In-memory **Pub/Sub engine** (no external brokers)
* Topic-based **message routing**
* **Real-time** event delivery over WebSockets
* **Thread-safe** concurrency handling
* **JWT authentication**
* Modular structure with **REST + WS endpoints**
* **Dockerized** setup for easy deployment

---

##  Data Models

### **User**

| Field        | Type        | Description           |
| ------------ | ----------- | --------------------- |
| `id`         | `uint`      | Primary key           |
| `email`      | `string`    | Unique email ID       |
| `password`   | `string`    | Hashed password       |
| `name`       | `string`    | User‚Äôs full name      |
| `created_at` | `time.Time` | Creation timestamp    |
| `updated_at` | `time.Time` | Last update timestamp |

---

## API Endpoints

### **WebSocket Endpoint**

| Method | Path  | Description                                  |
| ------ | ----- | -------------------------------------------- |
| `WS`   | `/ws` | Handle publish, subscribe, unsubscribe, ping |

#### **Supported Message Types**

**Client ‚Üí Server**

* `subscribe`
* `unsubscribe`
* `publish`
* `ping`

**Server ‚Üí Client**

* `ack`
* `event`
* `error`
* `pong`
* `info`

---

### **REST Endpoints**

| Method   | Endpoint            | Description        |
| -------- | ------------------- | ------------------ |
| `POST`   | `/topics`           | Create topic       |
| `DELETE` | `/topics/:name`     | Delete topic       |
| `GET`    | `/topics`           | List topics        |
| `GET`    | `/health`           | Health check       |
| `GET`    | `/stats`            | Show topic stats   |
| `POST`   | `/api/auth/signup`  | Register new user  |
| `POST`   | `/api/auth/signin`  | Log in user        |
| `POST`   | `/api/auth/signout` | Log out user (JWT) |

---

## Authentication

* Uses **JWT (HS256)** for stateless authentication.

* Tokens are generated on successful **signup** or **signin**.

* Protected routes require a valid token in the header:

  ```
  Authorization: Bearer <token>
  ```

* Token expiration and secret key are configurable in YAML.

---

## Development & Deployment

### Local Setup

#### **Install Dependencies**

```bash
make setup
```

#### **Run Application**

```bash
make run
```

---

### Docker Setup

#### **Build Docker Image**

```bash
make docker-build
```

#### **Run Docker Container**

```bash
make docker-run
```

#### **Clean Build Files**

```bash
make clean
```

---

## Stretch Goals

These enhancements improve system resilience, reliability, and usability.

### 1. Backpressure Handling
Implements **bounded per-subscriber queues** to prevent memory exhaustion.  
When a subscriber is too slow, the system either:
- **Drops the oldest messages** (default policy), or  
- **Disconnects the client** with a `SLOW_CONSUMER` error if queue overflow persists.  
This ensures fairness and protects overall system performance.

### 2. Graceful Shutdown
On shutdown, the server:
- Stops accepting new connections and publish operations.  
- Performs a **best-effort flush** of pending messages.  
- Closes all WebSocket connections cleanly to prevent data loss.

### 3. Message Replay
Supports a **ring buffer (last 100 messages)** per topic.  
Clients can request recent history using a `last_n` parameter (e.g., `last_n=10`) to replay recent events upon (re)subscription.

### 4. Basic Authentication
Adds lightweight **API key‚Äìbased authentication** for REST and WebSocket endpoints using the `X-API-Key` header.  
Unauthorized requests return a `401 Unauthorized` error.  
Can be combined with JWT-based security for enhanced access control.


## Maintainer

**Author:** Hari Krishna Moorthy
üìß [LinkedIn](https://www.linkedin.com/in/hari-krishna-moorthy/) | üíª [GitHub](https://github.com/Hari-Krishna-Moorthy)

---

**License:** MIT ¬© 2025 Hari Krishna Moorthy
